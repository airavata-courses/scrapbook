!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@ngxs/store"),require("@angular/router"),require("@angular/common"),require("@ngxs/store/internals"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@ngxs/router-plugin",["exports","@angular/core","@ngxs/store","@angular/router","@angular/common","@ngxs/store/internals","rxjs/operators"],e):e(((t=t||self).ngxs=t.ngxs||{},t.ngxs["router-plugin"]={}),t.ng.core,t["ngxs-store"],t.ng.router,t.ng.common,t["ngxs-store-internals"],t.rxjs.operators)}(this,(function(t,e,r,n,o,i,a){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var s=function(){return(s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function u(t,e,r,n){var o,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a}function c(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var l=function(){function t(t,e,r){this.path=t,this.queryParams=e,this.extras=r}return Object.defineProperty(t,"type",{get:function(){return"[Router] Navigate"},enumerable:!0,configurable:!0}),t}();var g=function(){function t(t,e,r){void 0===r&&(r="none"),this.routerState=t,this.event=e,this.trigger=r}return Object.defineProperty(t,"type",{get:function(){return"[Router] RouterNavigation"},enumerable:!0,configurable:!0}),t}();var p=function(){function t(t,e,r,n){void 0===n&&(n="none"),this.routerState=t,this.storeState=e,this.event=r,this.trigger=n}return Object.defineProperty(t,"type",{get:function(){return"[Router] RouterCancel"},enumerable:!0,configurable:!0}),t}();var h=function(){function t(t,e,r,n){void 0===n&&(n="none"),this.routerState=t,this.storeState=e,this.event=r,this.trigger=n}return Object.defineProperty(t,"type",{get:function(){return"[Router] RouterError"},enumerable:!0,configurable:!0}),t}();var f=function(){function t(t,e,r){void 0===r&&(r="none"),this.routerState=t,this.event=e,this.trigger=r}return Object.defineProperty(t,"type",{get:function(){return"[Router] RouterDataResolved"},enumerable:!0,configurable:!0}),t}();var d=function(){};var y=function(){function t(){}return t.prototype.serialize=function(t){return{root:this.serializeRoute(t.root),url:t.url}},t.prototype.serializeRoute=function(t){var e=this,r=t.children.map((function(t){return e.serializeRoute(t)}));return{url:t.url,params:t.params,queryParams:t.queryParams,fragment:t.fragment,data:t.data,outlet:t.outlet,component:null,routeConfig:null,root:null,parent:null,firstChild:r[0],children:r,pathFromRoot:null,paramMap:t.paramMap,queryParamMap:t.queryParamMap,toString:t.toString}},t}();var v=function(){function t(t,e,r,n,o,i,a){this._store=t,this._router=e,this._serializer=r,this._ngZone=n,this._urlSerializer=o,this._locationStrategy=i,this._location=a,this._trigger="none",this._routerState=null,this._storeState=null,this._lastRoutesRecognized=null,this.setUpStoreListener(),this.setUpRouterEventsListener(),this.checkInitialNavigationOnce()}var y;return y=t,t.state=function(t){return t&&t.state},t.url=function(t){return t&&t.state&&t.state.url},t.prototype.navigate=function(t,e){var r=this;return this._ngZone.run((function(){return r._router.navigate(e.path,s({queryParams:e.queryParams},e.extras))}))},t.prototype.angularRouterAction=function(t,e){t.setState(s({},t.getState(),{trigger:e.trigger,state:e.routerState,navigationId:e.event.id}))},t.prototype.setUpStoreListener=function(){var t=this;this._store.select(y).subscribe((function(e){t.navigateIfNeeded(e)}))},t.prototype.setUpRouterEventsListener=function(){var t=this;this._router.events.subscribe((function(e){e instanceof n.NavigationStart?t.navigationStart():e instanceof n.RoutesRecognized?t._lastRoutesRecognized=e:e instanceof n.ResolveEnd?t.dispatchRouterDataResolved(e):e instanceof n.NavigationCancel?(t.dispatchRouterCancel(e),t.reset()):e instanceof n.NavigationError?(t.dispatchRouterError(e),t.reset()):e instanceof n.NavigationEnd&&(t.navigationEnd(),t.reset())}))},t.prototype.navigationStart=function(){this._routerState=this._serializer.serialize(this._router.routerState.snapshot),"none"!==this._trigger&&(this._storeState=this._store.selectSnapshot(y))},t.prototype.navigationEnd=function(){this.shouldDispatchRouterNavigation()&&this.dispatchRouterNavigation()},t.prototype.shouldDispatchRouterNavigation=function(){return!this._storeState||"store"!==this._trigger},t.prototype.navigateIfNeeded=function(t){var e=this;!this._storeState||!this._storeState.state||!t||"router"===t.trigger||this._router.url===this._storeState.state.url||(this._trigger="store",this._ngZone.run((function(){e._router.navigateByUrl(e._storeState.state.url)})))},t.prototype.dispatchRouterNavigation=function(){var t=this._serializer.serialize(this._lastRoutesRecognized.state);this.dispatchRouterAction(new g(t,new n.RoutesRecognized(this._lastRoutesRecognized.id,this._lastRoutesRecognized.url,this._lastRoutesRecognized.urlAfterRedirects,t),this._trigger))},t.prototype.dispatchRouterCancel=function(t){this.dispatchRouterAction(new p(this._routerState,this._storeState,t,this._trigger))},t.prototype.dispatchRouterError=function(t){this.dispatchRouterAction(new h(this._routerState,this._storeState,new n.NavigationError(t.id,t.url,""+t),this._trigger))},t.prototype.dispatchRouterAction=function(t){this._trigger="router";try{this._store.dispatch(t)}finally{this._trigger="none"}},t.prototype.dispatchRouterDataResolved=function(t){var e=this._serializer.serialize(t.state);this.dispatchRouterAction(new f(e,t,this._trigger))},t.prototype.reset=function(){this._trigger="none",this._storeState=null,this._routerState=null},t.prototype.checkInitialNavigationOnce=function(){var t=this;i.isAngularInTestMode()||this._router.events.pipe(a.first((function(t){return t instanceof n.RoutesRecognized}))).subscribe((function(e){var r=e.url,n=t._location.normalize(t._locationStrategy.path(!0)),o=t._urlSerializer.parse(n);t._urlSerializer.serialize(o)!==r&&t._router.navigateByUrl(n)}))},t.ctorParameters=function(){return[{type:r.Store},{type:n.Router},{type:d},{type:e.NgZone},{type:n.UrlSerializer},{type:o.LocationStrategy},{type:o.Location}]},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:r.Store},{type:n.Router},{type:d},{type:e.NgZone},{type:n.UrlSerializer},{type:o.LocationStrategy},{type:o.Location}]},u([r.Action(l),c("design:type",Function),c("design:paramtypes",[Object,l]),c("design:returntype",void 0)],t.prototype,"navigate",null),u([r.Action([g,h,p,f]),c("design:type",Function),c("design:paramtypes",[Object,Object]),c("design:returntype",void 0)],t.prototype,"angularRouterAction",null),u([r.Selector(),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],t,"state",null),u([r.Selector(),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Object)],t,"url",null),t=y=u([r.State({name:"router",defaults:{state:void 0,navigationId:void 0,trigger:"none"}}),c("design:paramtypes",[r.Store,n.Router,d,e.NgZone,n.UrlSerializer,o.LocationStrategy,o.Location])],t)}();var R=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[{provide:d,useClass:y}]}},t.decorators=[{type:e.NgModule,args:[{imports:[r.NgxsModule.forFeature([v])]}]}],t}();t.DefaultRouterStateSerializer=y,t.Navigate=l,t.NgxsRouterPluginModule=R,t.RouterCancel=p,t.RouterDataResolved=f,t.RouterError=h,t.RouterNavigation=g,t.RouterState=v,t.RouterStateSerializer=d,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngxs-router-plugin.umd.min.js.map